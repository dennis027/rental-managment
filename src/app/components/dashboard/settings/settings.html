<div class="container-fluid p-4">
  <!-- Header Section -->
  <div class="mb-3">
    <h2 class="mb-1" style="font-weight: 600; color: #1a1a1a;">Settings</h2>
    <p style="color: #666; margin: 0; font-size: 14px;">Configure your property management system parameters</p>
  </div>

  <!-- Property Selection Card -->
  <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
    <mat-card-content class="p-3">
      <div class="row">
        <div class="col-md-6">
          <mat-form-field appearance="outline" class="full-width" style="width: 100%;">
            <mat-label>Select Property</mat-label>
            <mat-select [(ngModel)]="selectedPropertyId" (selectionChange)="getPropertyID($event)">
              @for (property of properties; track property.id) {
                <mat-option [value]="property.id">
                  {{ property.name }}
                </mat-option>
              }
            </mat-select>
          </mat-form-field>
        </div>
      </div>
    </mat-card-content>
  </mat-card>

  <!-- System Parameters Form -->
  <form [formGroup]="updateSystemParams">
    
    <!-- Financial Parameters Section -->
    <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
      <mat-card-content class="p-3">
        <h6 class="mb-2" style="font-weight: 600; color: #1a1a1a; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
          Financial Parameters
        </h6>
        
        <div class="row">
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Rent Deposit (Months)</mat-label>
              <input matInput type="number" formControlName="rent_deposit_months" (change)="onUpdateSystemParams()" />
              <mat-icon matSuffix style="color: #666;">calendar_today</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Late Payment Penalty (%)</mat-label>
              <input matInput type="number" formControlName="late_payment_penalty_rate" (change)="onUpdateSystemParams()" />
              <mat-icon matSuffix style="color: #666;">percent</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Grace Period (Days)</mat-label>
              <input matInput type="number" formControlName="grace_period_days" (change)="onUpdateSystemParams()" />
              <mat-icon matSuffix style="color: #666;">schedule</mat-icon>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Default Charges Section -->
    <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
      <mat-card-content class="p-3">
        <h6 class="mb-2" style="font-weight: 600; color: #1a1a1a; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
          Default Charges
        </h6>
        
        <div class="row">
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Default Service Charge</mat-label>
              <input matInput type="number" formControlName="default_service_charge" (change)="onUpdateSystemParams()" />
              <mat-icon matSuffix style="color: #666;">attach_money</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Default Security Charge</mat-label>
              <input matInput type="number" formControlName="default_security_charge" (change)="onUpdateSystemParams()" />
              <mat-icon matSuffix style="color: #666;">security</mat-icon>
            </mat-form-field>
          </div>
          <div class="col-md-4">
            <mat-form-field appearance="outline" class="full-width">
              <mat-label>Default Other Charge</mat-label>
              <input matInput type="number" formControlName="default_other_charge" (change)="onUpdateSystemParams()" />
              <mat-icon matSuffix style="color: #666;">more_horiz</mat-icon>
            </mat-form-field>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Billing Options Section -->
    <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
      <mat-card-content class="p-3">
        <h6 class="mb-2" style="font-weight: 600; color: #1a1a1a; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
          Billing Options
        </h6>
        
        <div class="row">
          <div class="col-md-3">
            <mat-slide-toggle formControlName="has_water_bill" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Include Water Bill</span>
            </mat-slide-toggle>
          </div>
          <div class="col-md-3">
            <mat-slide-toggle formControlName="has_electricity_bill" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Include Electricity Bill</span>
            </mat-slide-toggle>
          </div>
          <div class="col-md-3">
            <mat-slide-toggle formControlName="has_service_charge" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Include Service Charge</span>
            </mat-slide-toggle>
          </div>
          <div class="col-md-3">
            <mat-slide-toggle formControlName="has_security_charge" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Include Security Charge</span>
            </mat-slide-toggle>
          </div>
        </div>
        
        <div class="row mt-2">
          <div class="col-md-3">
            <mat-slide-toggle formControlName="has_other_charges" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Include Other Charges</span>
            </mat-slide-toggle>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

@if (systemParameters?.has_electricity_bill === true || systemParameters?.has_water_bill === true) {
  <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
    <mat-card-content class="p-3">
      <h6 class="mb-2" style="font-weight: 600; color: #1a1a1a; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
        Units Cost
      </h6>

      <div class="row">
        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Electricity Unit Cost</mat-label>
            <input
              matInput
              type="number"
              formControlName="electicity_unit_cost"
              (change)="onUpdateSystemParams()"
            />
            <mat-icon matSuffix style="color: #666;">power</mat-icon>
          </mat-form-field>
        </div>

        <div class="col-md-4">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Water Unit Cost</mat-label>
            <input
              matInput
              type="number"
              formControlName="water_unit_cost"
              (change)="onUpdateSystemParams()"
            />
            <mat-icon matSuffix style="color: #666;">water</mat-icon>
          </mat-form-field>
        </div>
      </div>
    </mat-card-content>
  </mat-card>
} @else {
  <!-- nothing will render when both are false -->
}


    <!-- Deposit Requirements Section -->
    <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
      <mat-card-content class="p-3">
        <h6 class="mb-2" style="font-weight: 600; color: #1a1a1a; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
          Deposit Requirements
        </h6>
        
        <div class="row">
          <div class="col-md-3">
            <mat-slide-toggle formControlName="require_water_deposit" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Require Water Deposit</span>
            </mat-slide-toggle>
          </div>
          <div class="col-md-3">
            <mat-slide-toggle formControlName="require_electricity_deposit" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Require Electricity Deposit</span>
            </mat-slide-toggle>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

    <!-- Payment & System Options Section -->
    <mat-card class="mb-3" style="box-shadow: 0 2px 8px rgba(0,0,0,0.08); border-radius: 12px;">
      <mat-card-content class="p-3">
        <h6 class="mb-2" style="font-weight: 600; color: #1a1a1a; border-bottom: 2px solid #e0e0e0; padding-bottom: 8px;">
          Payment & System Options
        </h6>
        
        <div class="row">
          <div class="col-md-3">
            <mat-slide-toggle formControlName="allow_partial_payments" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Allow Partial Payments</span>
            </mat-slide-toggle>
          </div>
          <div class="col-md-3">
            <mat-slide-toggle formControlName="auto_generate_receipts" color="primary" (change)="onUpdateSystemParams()">
              <span style="margin-left: 8px;">Auto Generate Receipts</span>
            </mat-slide-toggle>
          </div>
        </div>
      </mat-card-content>
    </mat-card>

  </form>
</div>